{
  "name": "–£–º–Ω—ã–π –¥–æ–º Telegram bot",
  "nodes": [
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.iot.yandex.net/v1.0/devices/actions",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "OAuth y0__xCz9dpKGIv0OyDi3uOzFR-JFhcGUUpU-lK-xYzT8FIkJVEQ"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n    \"devices\": [\n        {\n            \"id\": \"{{ $json.data.device_id }}\",\n            \"actions\": [\n                {\n                    \"type\": \"devices.capabilities.on_off\",\n                    \"state\": {\n                        \"instance\": \"on\",\n                        \"value\": {{ $json.data.action }}\n                    }\n                }\n            ]\n        }\n    ]\n}",
        "options": {
          "timeout": 100
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        944,
        272
      ],
      "id": "824e5779-8b42-4713-bcac-bdd44d0f75b9",
      "name": "–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "updates": [
          "*"
        ],
        "additionalFields": {
          "chatIds": ""
        }
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        48,
        80
      ],
      "id": "fe5d5e3d-d09d-4887-bc45-8d632f0bbeb5",
      "name": "Telegram Trigger",
      "webhookId": "0f55084e-c453-4149-8627-94a97313c8b8",
      "credentials": {
        "telegramApi": {
          "id": "qqtLZJZ7n8gk36NC",
          "name": "smart_home_alexlena_bot"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.message.from.id }}",
        "text": "–ª–ª–ª",
        "replyMarkup": "replyKeyboard",
        "replyKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "üîº –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫–∏ üîº",
                    "additionalFields": {}
                  }
                ]
              }
            }
          ]
        },
        "replyKeyboardOptions": {
          "resize_keyboard": true
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        720,
        -112
      ],
      "id": "278749f3-04c1-470c-a08e-0c5dc2c306d8",
      "name": "start",
      "webhookId": "9f534039-81ba-4071-8ae9-5ccc323cdd0c",
      "credentials": {
        "telegramApi": {
          "id": "qqtLZJZ7n8gk36NC",
          "name": "smart_home_alexlena_bot"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.message.from.id }}",
        "text": "–í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "–°–ø–∞–ª—å–Ω—è   üü¢  ",
                    "additionalFields": {
                      "callback_data": "–°–ø–∞–ª—å–Ω—è_on"
                    }
                  },
                  {
                    "text": "–°–ø–∞–ª—å–Ω—è   üî¥  ",
                    "additionalFields": {
                      "callback_data": "–°–ø–∞–ª—å–Ω—è_off"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "–ó–∞–ª             üü¢  ",
                    "additionalFields": {
                      "callback_data": "–ó–∞–ª_on"
                    }
                  },
                  {
                    "text": "–ó–∞–ª             üî¥  ",
                    "additionalFields": {
                      "callback_data": "–ó–∞–ª_off"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "–ö–æ—Ä–∏–¥–æ—Ä   üü¢  ",
                    "additionalFields": {
                      "callback_data": "–ö–æ—Ä–∏–¥–æ—Ä_on"
                    }
                  },
                  {
                    "text": "–ö–æ—Ä–∏–¥–æ—Ä   üî¥  ",
                    "additionalFields": {
                      "callback_data": "–ö–æ—Ä–∏–¥–æ—Ä_off"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "–í–∞–Ω–Ω–∞—è        üü¢  ",
                    "additionalFields": {
                      "callback_data": "–í–∞–Ω–Ω–∞—è_on"
                    }
                  },
                  {
                    "text": "–í–∞–Ω–Ω–∞—è        üî¥  ",
                    "additionalFields": {
                      "callback_data": "–í–∞–Ω–Ω–∞—è_off"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "–ö—É—Ö–Ω—è         üü¢  ",
                    "additionalFields": {
                      "callback_data": "–ö—É—Ö–Ω—è_on"
                    }
                  },
                  {
                    "text": "–ö—É—Ö–Ω—è         üî¥  ",
                    "additionalFields": {
                      "callback_data": "–ö—É—Ö–Ω—è_off"
                    }
                  }
                ]
              }
            },
            {},
            {
              "row": {
                "buttons": [
                  {
                    "text": "–®—Ç–æ—Ä—ã      üü¢  ",
                    "additionalFields": {
                      "callback_data": "–®—Ç–æ—Ä—ã_on"
                    }
                  },
                  {
                    "text": "–®—Ç–æ—Ä—ã      üî¥  ",
                    "additionalFields": {
                      "callback_data": "–®—Ç–æ—Ä—ã_off"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "–ü—ã–ª–µ—Å–æ—Å   üü¢  ",
                    "additionalFields": {
                      "callback_data": "–ü—ã–ª–µ—Å–æ—Å_on"
                    }
                  },
                  {
                    "text": "–ü—ã–ª–µ—Å–æ—Å   üî¥  ",
                    "additionalFields": {
                      "callback_data": "–ü—ã–ª–µ—Å–æ—Å_off"
                    }
                  }
                ]
              }
            },
            {
              "row": {
                "buttons": [
                  {
                    "text": "–í—ã–∫–ª—é—á–∏—Ç—å —Å–≤–µ—Ç –≤–µ–∑–¥–µ       üî¥  ",
                    "additionalFields": {
                      "callback_data": "–°–≤–µ—Ç_off"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        720,
        80
      ],
      "id": "c2c35b8b-a14b-4464-a33d-8e2ba0c6179b",
      "name": "–í—ã–≤–æ–¥ –∫–Ω–æ–ø–æ–∫",
      "webhookId": "6b2d1573-159e-4030-8ee6-40ac53afaf30",
      "credentials": {
        "telegramApi": {
          "id": "qqtLZJZ7n8gk36NC",
          "name": "smart_home_alexlena_bot"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.message.text }}",
                    "rightValue": "/start",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "1a83bb80-1b44-4aff-be80-a966e097b3a6"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "58ef493f-c698-47ec-90df-f9fe09ee73c4",
                    "leftValue": "={{ $json.message.text }}",
                    "rightValue": "üîº –ü–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫–∏ üîº",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        496,
        64
      ],
      "id": "7fc18896-1139-4f6b-821d-4b1bac0bcb14",
      "name": "–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä"
    },
    {
      "parameters": {
        "content": "## –¢–µ–ª–µ–≥—Ä–∞–º–º –±–æ—Ç –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ —É–º–Ω–æ–≥–æ –¥–æ–º–∞\n–í—ã–≤–æ–¥–∏—Ç –≤ —Ç–µ–ª–µ–≥—Ä–∞–º–º —Å–ø–∏—Å–æ–∫ –∫–Ω–æ–ø–æ–∫ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –∏ –≤—ã–∫–ª—é—á–µ–Ω–∏—è –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏ –∫–Ω–æ–ø–∫—É –≤—ã–∫–ª—é—á–µ–Ω–∏—è –≤—Å–µ–≥–æ –≤–µ—Ä—Ö–Ω–µ–≥–æ —Å–≤–µ—Ç–∞",
        "width": 400
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        16,
        -176
      ],
      "typeVersion": 1,
      "id": "e9341313-1740-40bf-a7a0-4e454289653b",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "# –ö—Ç–æ –º–æ–∂–µ—Ç —É–ø—Ä–∞–≤–ª—è—Ç—å\ntrue_ids = [249503190, 326830581]\n\nquery = _input.first().json\n\nfrom_id = 0\nif query.get(\"message\"):\n  from_id = query[\"message\"][\"from\"][\"id\"]\nelse:\n  from_id = query[\"callback_query\"][\"from\"][\"id\"]\n\nif from_id in true_ids:\n  return _input.first().json\nreturn [{\"json\": {}}]"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        272,
        80
      ],
      "id": "2c637c8c-047d-4b10-bca9-6417da4c0e5e",
      "name": "–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è"
    },
    {
      "parameters": {
        "language": "python",
        "pythonCode": "# –í—ã—è—Å–Ω—è–µ–º –∫—Ç–æ —á—Ç–æ —Å–¥–µ–ª–∞–ª –∏ –≥–æ—Ç–æ–≤–∏–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏—è\n\n# –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–æ–æ–±—â–µ–Ω–∏—è\nmessage = _input.first().json.callback_query\n\n# –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞\ndevices_id = {\n  \"–í–∞–Ω–Ω–∞—è\": \"2f9f9cc8-ada2-4bde-bd85-b9885ae28f36\",\n  \"–ö–æ—Ä–∏–¥–æ—Ä\": \"65bcfad0-4759-4cb7-8654-7584b2fc96d0\",\n  \"–ö—É—Ö–Ω—è\": \"a56d4cb7-621e-44ba-b825-4e9606a7acb4\",\n  \"–ó–∞–ª\": \"b0adbe30-5b28-40d1-9bf2-ba15aadd70bb\",\n  \"–°–ø–∞–ª—å–Ω—è\": \"f6826740-39db-484e-9e3e-2b2a7ed2f5ee\",\n  \"–õ–µ–Ω—Ç–∞\": \"\",\n  \"–ü—ã–ª–µ—Å–æ—Å\": \"2d5b0ab8-7880-4d79-a368-6120be845bfc\",\n  \"–®—Ç–æ—Ä—ã\": \"0197d9e0-ca35-4ea2-a31a-51516c63cdfe\"\n}\n\n# –¢–æ–ª—å–∫–æ –≤–µ—Ä—Ö–Ω–∏–π —Å–≤–µ—Ç\nlight_up = [\n  \"2f9f9cc8-ada2-4bde-bd85-b9885ae28f36\",  # –í–∞–Ω–Ω–∞—è\n  \"65bcfad0-4759-4cb7-8654-7584b2fc96d0\",  # –ö–æ—Ä–∏–¥–æ—Ä\n  \"a56d4cb7-621e-44ba-b825-4e9606a7acb4\",  # –ö—É—Ö–Ω—è\n  \"b0adbe30-5b28-40d1-9bf2-ba15aadd70bb\",  # –ó–∞–ª\n  \"f6826740-39db-484e-9e3e-2b2a7ed2f5ee\"   # –°–ø–∞–ª—å–Ω—è\n]\n\nkey = message.get(\"data\")  # –ü—Ä–∏—à–ª–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –∫–Ω–æ–ø–∫–∏\ndevice_action = key.split(\"_\")  # –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏ –¥–µ–π—Å—Ç–≤–∏–µ\n\ndata = {}  # –û—Ç–≤–µ—Ç\nif len(device_action) == 2:\n  # –°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ –Ω–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞\n  if device_action[0] in devices_id:\n    # –°—á–∏—Ç–∞–µ–º —á—Ç–æ –Ω–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞\n    device_id = devices_id[device_action[0]]  # –ù–∞–∑–≤–∞–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞\n    \n    action = None  # –î–µ–π—Å—Ç–≤–∏–µ\n    if device_action[1] == \"off\":\n      # –í—ã–∫–ª—é—á–µ–Ω–∏–µ\n      action = False\n    elif device_action[1] == \"on\":\n      # –í–∫–ª—é—á–µ–Ω–∏–µ\n      action = True\n      \n  else:\n    # –£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –Ω–µ—Ç –≤ —Å–ø–∏—Å–∫–µ. –í–æ–∑–º–æ–∂–Ω–æ —ç—Ç–æ –æ–±—â–∞—è –∫–æ–º–∞–Ω–¥–∞\n    if device_action[0] == \"–°–≤–µ—Ç\":\n      # –û–±—â–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –≤—ã–∫–ª—é—á–µ–Ω–∏—è —Å–≤–µ—Ç–∞\n      data = []\n      for device_id in light_up:\n        cmd = {\n          \"action\": False,\n          \"device_id\": device_id,\n        }\n        data.append({\"json\": {\"data\": cmd}})\n      return data\n\n# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç\nif action is not None:\n  data = {\n    \"action\": action,\n    \"device_id\": device_id,\n  }\n\nreturn [{\"json\": {\"data\": data}}]"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        720,
        272
      ],
      "id": "fd51b8dd-06f5-427d-aa35-d8ca85bce9ea",
      "name": "–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è",
      "onError": "continueRegularOutput"
    }
  ],
  "pinData": {},
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä": {
      "main": [
        [
          {
            "node": "start",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "–í—ã–≤–æ–¥ –∫–Ω–æ–ø–æ–∫",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è": {
      "main": [
        [
          {
            "node": "–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è": {
      "main": [
        [
          {
            "node": "–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "be94bb63-493a-4417-8c62-3464c73c3d02",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "bb7b53df3d0f2a0206bc0b3166415c891ab7f4fd6265183dec8739ad21abb12c"
  },
  "id": "wfL9CTLc1eGkEwmp",
  "tags": []
}